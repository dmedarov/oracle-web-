<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Comprehensive guide to building, pushing, and deploying Docker containers using GitHub Actions, Docker Hub, SSH, and Rocky Linux with automated updates via Watchtower."
    />
    <title>
      Automated Docker Deployment: GitHub Actions, Docker Hub, SSH, Rocky Linux
      & Watchtower
    </title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: 'Roboto', sans-serif;
        background-color: #f0f4f8;
        margin: 0;
        padding: 0;
        line-height: 1.7;
        color: #333;
      }
      h1,
      h2,
      h3,
      h4 {
        color: #2c3e50;
      }
      a {
        color: #3498db;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      .container {
        max-width: 1000px;
        margin: 40px auto;
        background: white;
        padding: 40px 30px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }
      .container h1 {
        font-size: 36px;
        text-align: center;
        margin-bottom: 20px;
      }
      .container p {
        margin-bottom: 20px;
        font-size: 18px;
        line-height: 1.8;
      }
      .container ul {
        list-style-type: disc;
        padding-left: 40px;
        margin-bottom: 30px;
      }
      pre,
      code {
        font-family: 'Courier New', Courier, monospace;
        font-size: 16px;
        color: #e74c3c;
        background-color: #f7f7f7;
        padding: 15px;
        border-left: 6px solid #3498db;
        border-radius: 5px;
        white-space: pre-wrap;
        word-wrap: break-word;
        overflow-x: auto;
      }
      .highlight {
        background-color: #e8f5e9;
        padding: 12px;
        border-left: 6px solid #2ecc71;
        border-radius: 5px;
        font-size: 16px;
        margin-bottom: 30px;
      }
      .warning {
        background-color: #fff3cd;
        padding: 12px;
        border-left: 6px solid #f39c12;
        border-radius: 5px;
        margin-bottom: 30px;
      }
      .note {
        background-color: #f0f4f8;
        padding: 20px;
        border-left: 6px solid #2980b9;
        margin-bottom: 30px;
        font-style: italic;
      }
      .btn-primary {
        display: inline-block;
        padding: 14px 28px;
        background-color: #2980b9;
        color: #fff;
        text-align: center;
        border-radius: 5px;
        font-size: 18px;
        transition: background-color 0.3s;
      }
      .btn-primary:hover {
        background-color: #1b4f72;
      }
      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }
        .container h1 {
          font-size: 28px;
        }
        pre,
        code {
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>
        Automated Docker Deployment: GitHub Actions, Docker Hub, SSH, Rocky
        Linux & Watchtower
      </h1>

      <p>
        This tutorial covers how to automatically build, push, and deploy Docker
        containers using <strong>GitHub Actions</strong>,
        <strong>Docker Hub</strong>, and <strong>SSH</strong> on a Rocky Linux
        server. Additionally, we'll set up <strong>Watchtower</strong> to keep
        your Docker container up-to-date.
      </p>

      <h2>Prerequisites</h2>
      <ul>
        <li>A Rocky Linux server with SSH access.</li>
        <li>
          Docker installed on both your local machine and the Rocky Linux
          server.
        </li>
        <li>
          A GitHub repository with your code and a Docker Hub account for
          storing images.
        </li>
        <li>
          GitHub Secrets set up for Docker Hub credentials and SSH access to
          your Rocky Linux server.
        </li>
      </ul>

      <h2 id="step-1">Step 1: Install Docker on Rocky Linux</h2>
      <p>
        If Docker isn't installed on your Rocky Linux server, use the following
        commands to install it:
      </p>
      <pre><code>sudo dnf update
sudo dnf install -y dnf-plugins-core
sudo dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo
sudo dnf install docker-ce docker-ce-cli containerd.io</code></pre>

      <p>Start Docker and enable it to start on boot:</p>
      <pre><code>sudo systemctl start docker
sudo systemctl enable docker</code></pre>

      <p>Verify Docker installation:</p>
      <pre><code>docker --version</code></pre>

      <h2>Step 2: Setting Up SSH for Secure Access</h2>
      <p>
        To securely connect to your Rocky Linux server from GitHub Actions, you
        need to set up SSH keys.
      </p>

      <h3>Generate SSH Key Pair</h3>
      <p>
        On your local machine, generate an SSH key pair (if you don't already
        have one):
      </p>
      <pre><code>ssh-keygen -t rsa -b 4096 -C "your_email@example.com"</code></pre>

      <p>After generating the key, add the public key to your server:</p>
      <pre><code>ssh-copy-id your_user@your_server_ip</code></pre>

      <p>
        Or manually add the public key to the
        <code>~/.ssh/authorized_keys</code> file on your server.
      </p>

      <h2>Step 3: Docker Hub Setup</h2>
      <p>Create a repository on Docker Hub to store your Docker images:</p>
      <ol>
        <li>
          Log in to
          <a href="https://hub.docker.com/" target="_blank">Docker Hub</a>.
        </li>
        <li>Create a new repository for your Docker images.</li>
      </ol>

      <h2>Step 4: Create a Dockerfile</h2>
      <p>
        Your Dockerfile defines how to build your application container. Here’s
        a simple example for a Node.js application:
      </p>
      <pre><code>FROM node:16
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 8080
CMD [ "node", "index.js" ]</code></pre>

      <p>Make sure the Dockerfile suits your application's requirements.</p>

      <h2>Step 5: Automating Builds with GitHub Actions</h2>
      <p>
        We’ll now automate Docker image building and pushing to Docker Hub via
        GitHub Actions:
      </p>
      <ol>
        <li>
          Create a <code>.github/workflows/docker-publish.yml</code> file in
          your GitHub repository.
        </li>
        <li>Add the following content:</li>
      </ol>
      <pre><code>name: Build and Push Docker Image

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_HUB_USERNAME }}
          password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}

      - name: Build and Push Docker Image
        uses: docker/build-push-action@v5
        with:
          push: true
          tags: ${{ secrets.DOCKER_HUB_USERNAME }}/my-app:latest</code></pre>

      <p>
        Replace <code>my-app</code> with the name of your Docker Hub repository.
      </p>

      <h2>Step 6: Deploy to Rocky Linux via SSH</h2>
      <h3>GitHub Actions Workflow</h3>
      <p>
        To automate deployment to your Rocky Linux server, create another
        workflow <code>deploy.yml</code>:
      </p>
      <pre><code>name: Deploy to Rocky Linux

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy via SSH
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.ROCKY_LINUX_HOST }}
          username: ${{ secrets.ROCKY_LINUX_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            docker pull ${{ secrets.DOCKER_HUB_USERNAME }}/my-app:latest
            docker stop my-app || true
            docker rm my-app || true
            docker run -d --name my-app -p 80:8080 ${{ secrets.DOCKER_HUB_USERNAME }}/my-app:latest</code></pre>

      <p>
        Make sure you’ve set up the SSH private key, username, and host details
        in your GitHub Secrets.
      </p>

      <h2>Step 7: Automating Updates with Watchtower</h2>
      <p>
        <strong>Watchtower</strong> is a simple container that monitors your
        running Docker containers and automatically updates them when new images
        are available. To set up Watchtower:
      </p>
      <pre><code>docker run -d \
  --name watchtower \
  -v /var/run/docker.sock:/var/run/docker.sock \
  containrrr/watchtower my-app \
  --interval 30</code></pre>

      <p>
        This will check for updates every 30 seconds and update the container
        automatically if a new image is available.
      </p>

      <h2>Conclusion & Next Steps</h2>
      <p>
        You now have a fully automated pipeline that builds, pushes, deploys,
        and keeps your Docker containers updated. To further enhance your setup,
        consider integrating:
      </p>
      <ul>
        <li>Error handling and notifications for failed deployments.</li>
        <li>
          Docker Compose or Kubernetes for managing multi-container
          environments.
        </li>
        <li>
          Monitoring with Prometheus or Grafana to track your application’s
          performance.
        </li>
      </ul>

      <div class="note">
        Congratulations! You've automated the lifecycle of your Docker
        applications using GitHub Actions, Docker Hub, SSH, and Watchtower!
      </div>

      <a href="https://hub.docker.com/" class="btn-primary"
        >Get Started with Docker Hub</a
      >
    </div>
  </body>
</html>
