<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Tutorial on pushing and deploying Docker container using GitHub Actions, Docker Hub, and Rocky Linux."
    />
    <title>
      Pushing and Deploying Docker Container using GitHub Actions, Docker Hub,
      and Rocky Linux
    </title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 800px;
        margin: 50px auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1,
      h2 {
        color: #333;
      }
      pre {
        background-color: #f4f4f4;
        padding: 10px;
        border-left: 4px solid #333;
        overflow-x: auto;
      }
      code {
        color: #d63384;
      }
      a {
        color: #007bff;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      ul {
        margin-left: 20px;
      }
      .note {
        background-color: #eaf7ea;
        padding: 10px;
        border-left: 4px solid #28a745;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>
        Pushing and Deploying Docker Container using GitHub Actions, Docker Hub,
        and Rocky Linux
      </h1>

      <p>
        This tutorial will guide you through automating the process of building,
        pushing, and deploying a Docker container using
        <strong>GitHub Actions</strong>, <strong>Docker Hub</strong>, and
        deploying it on your own <strong>Rocky Linux</strong> server.
      </p>

      <h2>Prerequisites</h2>
      <ul>
        <li><strong>Rocky Linux server</strong> with SSH access.</li>
        <li>
          <strong>Docker installed</strong> on both your local machine and the
          Rocky Linux server.
        </li>
        <li><strong>GitHub repository</strong> for your code.</li>
        <li>
          <strong>Docker Hub account</strong> for storing your Docker images.
        </li>
        <li>
          <strong>GitHub Secrets</strong> set up with your Docker Hub
          credentials.
        </li>
      </ul>

      <h2>Step 1: Set Up Docker on Your Rocky Linux Server</h2>
      <p>
        If Docker isn't installed on your Rocky Linux server, follow these
        commands:
      </p>
      <pre><code>sudo dnf update
sudo dnf install -y dnf-plugins-core
sudo dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo
sudo dnf install docker-ce docker-ce-cli containerd.io</code></pre>

      <p>Start Docker and enable it to start on boot:</p>
      <pre><code>sudo systemctl start docker
sudo systemctl enable docker</code></pre>

      <p>Verify Docker is running:</p>
      <pre><code>docker --version</code></pre>

      <h2>Step 2: Docker Hub - Create a Repository</h2>
      <p>
        1. Log in to <a href="https://hub.docker.com/">Docker Hub</a>.<br />
        2. Create a new repository to store your Docker image. Make it public or
        private as needed.
      </p>

      <h2>Step 3: Create a Dockerfile</h2>
      <p>
        Create a <code>Dockerfile</code> in your project directory. Here's a
        simple example:
      </p>
      <pre><code>FROM node:16
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 8080
CMD [ "node", "index.js" ]</code></pre>

      <h2>
        Step 4: GitHub Actions Workflow for Building and Pushing to Docker Hub
      </h2>
      <p>
        Set up GitHub Actions to automate building and pushing the Docker image
        to Docker Hub when changes are pushed to the main branch.
      </p>
      <p>
        Create a directory <code>.github/workflows/</code> in your GitHub
        repository, then create a file <code>docker-publish.yml</code>:
      </p>

      <pre><code>name: Build and Push Docker Image

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_HUB_USERNAME }}
          password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}

      - name: Build and Push Docker Image
        uses: docker/build-push-action@v5
        with:
          push: true
          tags: ${{ secrets.DOCKER_HUB_USERNAME }}/my-app:latest</code></pre>

      <p>
        Make sure you replace <code>my-app</code> with your Docker Hub
        repository's name.
      </p>

      <h2>Step 5: Deploying on Rocky Linux Server with Docker</h2>
      <p>
        Once the Docker image is pushed to Docker Hub, we can deploy it on the
        Rocky Linux server.
      </p>

      <h3>Step 5.1: Set up SSH keys (if needed)</h3>
      <p>Generate SSH keys to securely connect to your server:</p>
      <pre><code>ssh-keygen -t rsa -b 4096 -C "your_email@example.com"</code></pre>
      <p>
        Add the public key to <code>~/.ssh/authorized_keys</code> on your
        server.
      </p>

      <h3>Step 5.2: Create a GitHub Actions Deployment Workflow</h3>
      <p>
        Now, create a new GitHub Actions workflow to SSH into your Rocky Linux
        server and pull the Docker image:
      </p>
      <pre><code>name: Deploy to Rocky Linux

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy over SSH
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.ROCKY_LINUX_HOST }}
          username: ${{ secrets.ROCKY_LINUX_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            docker pull ${{ secrets.DOCKER_HUB_USERNAME }}/my-app:latest
            docker stop my-app || true
            docker rm my-app || true
            docker run -d --name my-app -p 80:8080 ${{ secrets.DOCKER_HUB_USERNAME }}/my-app:latest</code></pre>

      <p>
        Replace the placeholders with your own values, and add the necessary
        secrets in your GitHub repository.
      </p>

      <h2>Step 6: Testing the Pipeline</h2>
      <p>
        Push your code changes to GitHub. The pipeline will trigger both
        workflows to build, push, and deploy your Docker container
        automatically.
      </p>

      <h2>Conclusion</h2>
      <p>
        You've successfully automated the process of building, pushing, and
        deploying a Docker container using <strong>GitHub Actions</strong>,
        <strong>Docker Hub</strong>, and a <strong>Rocky Linux</strong> server!
      </p>

      <div class="note">
        <strong>Next Steps:</strong> Consider adding error handling and scaling
        your deployment with Docker Compose or Kubernetes.
      </div>
    </div>
  </body>
</html>
